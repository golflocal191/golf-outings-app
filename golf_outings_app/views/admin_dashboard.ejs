<% layout('layout', { title: 'Admin Dashboard', session: session }); %>

<h1 class="mb-4">Admin Dashboard</h1>
<p class="mb-3">Manage events and sign‑ups.</p>
<a href="/admin/events/new" class="btn btn-success mb-4">Create New Event</a>

<% if (message) { %>
  <div class="alert alert-info"><%= message %></div>
<% } %>

<% Object.keys(grouped).forEach(eventId => { const item = grouped[eventId]; const event = item.event; const signups = item.signups; %>
  <div class="card mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0"><%= event.title %></h5>
    </div>
    <div class="card-body">
      <p><strong>Date & Time:</strong> <%= formatDate(event.date) %></p>
      <p><strong>Location:</strong> <%= event.location %></p>
      <p><strong>Description:</strong> <%= event.description || 'N/A' %></p>
      <p><strong>Total Sign‑ups:</strong> <%= signups.length %></p>
      <% if (signups.length > 0) { %>
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Contact #</th>
                <th>Handicap</th>
                <th>Notes</th>
                <th>Registered</th>
              </tr>
            </thead>
            <tbody>
              <% signups.forEach(su => { %>
                <tr>
                  <td><%= su.name %></td>
                  <td><%= su.email %></td>
                  <td><%= su.phone || '-' %></td>
                  <td><%= su.handicap || '-' %></td>
                  <td><%= su.notes || '-' %></td>
                  <td><%= formatDate(su.timestamp) %></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
        <form method="post" action="/admin/notify/<%= event.id %>" class="mt-3">
          <button type="submit" class="btn btn-primary">Send Reminder Email to All</button>
        </form>
      <% } else { %>
        <p>No sign‑ups yet.</p>
      <% } %>
    </div>
  </div>
<% }); %>